<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Download Image</title>
    </head>
    <body>
        <div>
            <div style="text-align:center;">
                <input type="button" value="Выбрать" id="select-file"/>
                <input type="text" placeholder="Выберите файл экспорта" id="path-file" size="30" disabled="disabled"/>
            </div>
            <div style="text-align:center;">
                <input type="button" value="Выбрать" id="select-dir"/>
                <input type="text" placeholder="Выберите папку куда сохранять" size="30" id="path-dir" disabled="disabled"/>
            </div>
            <br><br>
            <p id="create" style="text-align:center;"></p>
            <ul id="log"></ul>
        </div>
            <script>
            const {dialog} = require('electron').remote
            const {remote} = require('electron')
            const {Menu} = remote
            const request = require('sync-request');
            const fs = require('fs');
            
            let file = [];
            let dir = []; 
            console.log(dir)
            
            function write(text) {
                var li = log.appendChild(document.createElement('li'));
                li.innerHTML = text;
            }
            
            function createBut() {
                var button = document.createElement('input')
                button.type = 'button';
                button.value = 'Начать';
                button.id = 'start-file';
                button.onclick = function () {
                    start();
                };
                create.appendChild(button);
            }
                
            var i = 0
            function start() {
                function readFile(nameFile) {
                    fs.readFile(nameFile, 'utf8', function(err, contents) {
                        if (!err) {
                            readLine(contents.split('\n'));
                        } else {
                            console.log('Ошибка', err);
                        }
                    });
                }
                
                function readLine(array) {
                    array.forEach(function(uri) {
                        var img_name = decodeURIComponent(uri.split('/').slice(-1))
                        var res = request("GET", uri);
                        fs.writeFileSync(dir[0] + '/' + img_name, res.body);
                        console.log( i += 1);
                        console.log(img_name, ' OK');
                        write(img_name); 
                    }); 
                };
                console.log(file[0])
                readFile(file[0]);
            }
                         
            document.getElementById('select-dir').addEventListener('click',function() {
                dialog.showOpenDialog({properties: ['openDirectory']}, function (fileNames) {
                    if(fileNames === undefined) {
                        console.log("No file selected");
                    } else {
                        console.log(fileNames);
                        dir.push(fileNames[0]);
                        console.log(dir);
                        document.getElementById("path-dir").value = fileNames[0];
                    }
                }); 
            }, false);
            
            document.getElementById('select-file').addEventListener('click',function() {
                dialog.showOpenDialog({properties: ['openFile'], filters: [{name: "File", extensions: ['txt']}]}, function (fileNames) {
                    if(fileNames === undefined) {
                        console.log("No file selected");
                    } else {
                        console.log(fileNames)
                        file.push(fileNames[0]);
                        document.getElementById("path-file").value = fileNames[0];
                        createBut();
                    }
                }); 
            }, false);
            </script>
        </div>
    </body>
</html>